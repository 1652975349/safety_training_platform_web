<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·»åŠ é¢˜ç›® - å®‰å…¨åŸ¹è®­å¹³å°</title>
    <link rel="stylesheet" href="../common/styles.css">
</head>
<body>
<!-- é¡¶éƒ¨é€šæ  - ç›´æ¥åµŒå…¥ -->
<header class="header">
    <div class="header-left">
        <div class="logo">å®‰å…¨åŸ¹è®­å¹³å°</div>
        <div class="role-switcher">
            <button class="role-btn" onclick="switchRole('student')">å­¦å‘˜ç«¯</button>
            <button class="role-btn active" onclick="switchRole('admin')">ç®¡ç†å‘˜ç«¯</button>
        </div>
    </div>
    <div class="header-right">
        <div class="user-info">
            <div class="avatar">ğŸ‘¤</div>
            <span id="currentUser">ç®¡ç†å‘˜</span>
        </div>
        <button class="btn btn-secondary" onclick="logout()">é€€å‡º</button>
    </div>
</header>

<!-- å·¦ä¾§èœå• - ç›´æ¥åµŒå…¥ -->
<nav class="sidebar" id="sidebar">
    <ul class="sidebar-menu" id="sidebarMenu">
        <li class="menu-item">
            <a href="dashboard_simple.html" class="menu-link">
                <span class="menu-icon">ğŸ </span>
                <span class="menu-text">é¦–é¡µ</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="personnel.html" class="menu-link">
                <span class="menu-icon">ğŸ‘¥</span>
                <span class="menu-text">äººå‘˜ç®¡ç†</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="training.html" class="menu-link">
                <span class="menu-icon">ğŸ“š</span>
                <span class="menu-text">åŸ¹è®­ç®¡ç†</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="content.html" class="menu-link active">
                <span class="menu-icon">ğŸ“„</span>
                <span class="menu-text">å†…å®¹ç®¡ç†</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="statistics.html" class="menu-link">
                <span class="menu-icon">ğŸ“Š</span>
                <span class="menu-text">ç»Ÿè®¡åˆ†æ</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="settings.html" class="menu-link">
                <span class="menu-icon">âš™ï¸</span>
                <span class="menu-text">ç³»ç»Ÿè®¾ç½®</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="notifications.html" class="menu-link">
                <span class="menu-icon">ğŸ””</span>
                <span class="menu-text">é€šçŸ¥ç®¡ç†</span>
            </a>
        </li>
    </ul>
</nav>
    
    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
        <div class="content-header">
            <h1 class="page-title">æ·»åŠ é¢˜ç›®</h1>
            <p class="page-subtitle">åˆ›å»ºæ–°çš„è€ƒè¯•é¢˜ç›®</p>
        </div>
        
        <!-- é¢˜ç›®åˆ›å»ºè¡¨å• -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">é¢˜ç›®ä¿¡æ¯</h2>
            </div>
            <div class="card-body">
                <form id="questionForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="questionType">é¢˜ç›®ç±»å‹ *</label>
                            <select id="questionType" class="form-control" required onchange="toggleQuestionOptions()">
                                <option value="">è¯·é€‰æ‹©é¢˜ç›®ç±»å‹</option>
                                <option value="single">å•é€‰é¢˜</option>
                                <option value="multiple">å¤šé€‰é¢˜</option>
                                <option value="judge">åˆ¤æ–­é¢˜</option>
                                <option value="essay">ç®€ç­”é¢˜</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="questionCategory">é¢˜ç›®åˆ†ç±» *</label>
                            <select id="questionCategory" class="form-control" required>
                                <option value="">è¯·é€‰æ‹©é¢˜ç›®åˆ†ç±»</option>
                                <option value="safety">å®‰å…¨ç”Ÿäº§</option>
                                <option value="electrical">ç”µæ°”å®‰å…¨</option>
                                <option value="fire">æ¶ˆé˜²å®‰å…¨</option>
                                <option value="chemical">åŒ–å·¥å®‰å…¨</option>
                                <option value="equipment">è®¾å¤‡å®‰å…¨</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="questionDifficulty">éš¾åº¦ç­‰çº§ *</label>
                            <select id="questionDifficulty" class="form-control" required>
                                <option value="">è¯·é€‰æ‹©éš¾åº¦ç­‰çº§</option>
                                <option value="easy">ç®€å•</option>
                                <option value="medium">ä¸­ç­‰</option>
                                <option value="hard">å›°éš¾</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="questionScore">é¢˜ç›®åˆ†å€¼</label>
                            <input type="number" id="questionScore" class="form-control" value="2" min="1" max="10">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="questionContent">é¢˜ç›®å†…å®¹ *</label>
                        <textarea id="questionContent" class="form-control" rows="4" placeholder="è¯·è¾“å…¥é¢˜ç›®å†…å®¹" required></textarea>
                    </div>
                    
                    <!-- é€‰é¡¹åŒºåŸŸ -->
                    <div id="optionsArea" style="display: none;">
                        <div class="form-group">
                            <label>é€‰é¡¹è®¾ç½®</label>
                            <div id="optionsList">
                                <!-- é€‰é¡¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                            <button type="button" class="btn btn-secondary btn-sm" onclick="addOption()">æ·»åŠ é€‰é¡¹</button>
                        </div>
                    </div>
                    
                    <!-- æ­£ç¡®ç­”æ¡ˆåŒºåŸŸ -->
                    <div class="form-group">
                        <label for="correctAnswer">æ­£ç¡®ç­”æ¡ˆ *</label>
                        <div id="answerArea">
                            <!-- ç­”æ¡ˆè¾“å…¥åŒºåŸŸå°†æ ¹æ®é¢˜ç›®ç±»å‹åŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="questionExplanation">ç­”æ¡ˆè§£æ</label>
                        <textarea id="questionExplanation" class="form-control" rows="3" placeholder="è¯·è¾“å…¥ç­”æ¡ˆè§£æ"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="questionTags">æ ‡ç­¾</label>
                        <input type="text" id="questionTags" class="form-control" placeholder="è¯·è¾“å…¥æ ‡ç­¾ï¼Œç”¨é€—å·åˆ†éš”">
                        <small class="form-text text-muted">ä¾‹å¦‚ï¼šåŸºç¡€çŸ¥è¯†,å®‰å…¨æ³•è§„,æ“ä½œè§„èŒƒ</small>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="goBack()">å–æ¶ˆ</button>
                        <button type="button" class="btn btn-warning" onclick="saveDraft()">ä¿å­˜è‰ç¨¿</button>
                        <button type="submit" class="btn btn-primary">ä¿å­˜é¢˜ç›®</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- é¢˜ç›®é¢„è§ˆ -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">é¢˜ç›®é¢„è§ˆ</h2>
            </div>
            <div class="card-body">
                <div id="questionPreview" class="question-preview">
                    <p class="text-muted">è¯·å¡«å†™é¢˜ç›®ä¿¡æ¯åæŸ¥çœ‹é¢„è§ˆ</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let optionCount = 0;
        
        // åˆ‡æ¢é¢˜ç›®é€‰é¡¹
        function toggleQuestionOptions() {
            const questionType = document.getElementById('questionType').value;
            const optionsArea = document.getElementById('optionsArea');
            const answerArea = document.getElementById('answerArea');
            
            if (questionType === 'single' || questionType === 'multiple') {
                optionsArea.style.display = 'block';
                generateOptions();
                generateAnswerOptions();
            } else if (questionType === 'judge') {
                optionsArea.style.display = 'none';
                generateJudgeAnswer();
            } else if (questionType === 'essay') {
                optionsArea.style.display = 'none';
                generateEssayAnswer();
            } else {
                optionsArea.style.display = 'none';
                answerArea.innerHTML = '';
            }
            
            updatePreview();
        }
        
        // ç”Ÿæˆé€‰é¡¹
        function generateOptions() {
            const optionsList = document.getElementById('optionsList');
            optionsList.innerHTML = '';
            optionCount = 0;
            
            // é»˜è®¤æ·»åŠ 4ä¸ªé€‰é¡¹
            for (let i = 0; i < 4; i++) {
                addOption();
            }
        }
        
        // æ·»åŠ é€‰é¡¹
        function addOption() {
            optionCount++;
            const optionsList = document.getElementById('optionsList');
            const optionDiv = document.createElement('div');
            optionDiv.className = 'option-item';
            optionDiv.innerHTML = `
                <div class="option-content">
                    <label class="option-label">é€‰é¡¹ ${String.fromCharCode(64 + optionCount)}</label>
                    <input type="text" class="form-control option-input" placeholder="è¯·è¾“å…¥é€‰é¡¹å†…å®¹">
                    <button type="button" class="btn btn-danger btn-sm" onclick="removeOption(this)">åˆ é™¤</button>
                </div>
            `;
            optionsList.appendChild(optionDiv);
        }
        
        // åˆ é™¤é€‰é¡¹
        function removeOption(button) {
            if (optionCount > 2) {
                button.closest('.option-item').remove();
                optionCount--;
                updateOptionLabels();
            } else {
                alert('è‡³å°‘éœ€è¦ä¿ç•™2ä¸ªé€‰é¡¹');
            }
        }
        
        // æ›´æ–°é€‰é¡¹æ ‡ç­¾
        function updateOptionLabels() {
            const options = document.querySelectorAll('.option-label');
            options.forEach((label, index) => {
                label.textContent = `é€‰é¡¹ ${String.fromCharCode(65 + index)}`;
            });
        }
        
        // ç”Ÿæˆç­”æ¡ˆé€‰é¡¹
        function generateAnswerOptions() {
            const answerArea = document.getElementById('answerArea');
            const questionType = document.getElementById('questionType').value;
            
            if (questionType === 'single') {
                answerArea.innerHTML = `
                    <select class="form-control" id="correctAnswer">
                        <option value="">è¯·é€‰æ‹©æ­£ç¡®ç­”æ¡ˆ</option>
                    </select>
                `;
            } else if (questionType === 'multiple') {
                answerArea.innerHTML = `
                    <div id="multipleAnswers">
                        <p>è¯·é€‰æ‹©æ­£ç¡®ç­”æ¡ˆï¼ˆå¯å¤šé€‰ï¼‰ï¼š</p>
                    </div>
                `;
            }
            
            updateAnswerOptions();
        }
        
        // æ›´æ–°ç­”æ¡ˆé€‰é¡¹
        function updateAnswerOptions() {
            const questionType = document.getElementById('questionType').value;
            const options = document.querySelectorAll('.option-input');
            
            if (questionType === 'single') {
                const select = document.getElementById('correctAnswer');
                select.innerHTML = '<option value="">è¯·é€‰æ‹©æ­£ç¡®ç­”æ¡ˆ</option>';
                options.forEach((option, index) => {
                    const optionElement = document.createElement('option');
                    optionElement.value = String.fromCharCode(65 + index);
                    optionElement.textContent = `${String.fromCharCode(65 + index)}. ${option.value || 'é€‰é¡¹' + (index + 1)}`;
                    select.appendChild(optionElement);
                });
            } else if (questionType === 'multiple') {
                const multipleAnswers = document.getElementById('multipleAnswers');
                multipleAnswers.innerHTML = '<p>è¯·é€‰æ‹©æ­£ç¡®ç­”æ¡ˆï¼ˆå¯å¤šé€‰ï¼‰ï¼š</p>';
                options.forEach((option, index) => {
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.className = 'form-check';
                    checkboxDiv.innerHTML = `
                        <input class="form-check-input" type="checkbox" value="${String.fromCharCode(65 + index)}" id="answer${index}">
                        <label class="form-check-label" for="answer${index}">
                            ${String.fromCharCode(65 + index)}. ${option.value || 'é€‰é¡¹' + (index + 1)}
                        </label>
                    `;
                    multipleAnswers.appendChild(checkboxDiv);
                });
            }
        }
        
        // ç”Ÿæˆåˆ¤æ–­é¢˜ç­”æ¡ˆ
        function generateJudgeAnswer() {
            const answerArea = document.getElementById('answerArea');
            answerArea.innerHTML = `
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="judgeAnswer" value="true" id="judgeTrue">
                    <label class="form-check-label" for="judgeTrue">æ­£ç¡®</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="judgeAnswer" value="false" id="judgeFalse">
                    <label class="form-check-label" for="judgeFalse">é”™è¯¯</label>
                </div>
            `;
        }
        
        // ç”Ÿæˆç®€ç­”é¢˜ç­”æ¡ˆ
        function generateEssayAnswer() {
            const answerArea = document.getElementById('answerArea');
            answerArea.innerHTML = `
                <textarea class="form-control" id="essayAnswer" rows="4" placeholder="è¯·è¾“å…¥å‚è€ƒç­”æ¡ˆ"></textarea>
            `;
        }
        
        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            const questionType = document.getElementById('questionType').value;
            const questionContent = document.getElementById('questionContent').value;
            const preview = document.getElementById('questionPreview');
            
            if (!questionType || !questionContent) {
                preview.innerHTML = '<p class="text-muted">è¯·å¡«å†™é¢˜ç›®ä¿¡æ¯åæŸ¥çœ‹é¢„è§ˆ</p>';
                return;
            }
            
            let previewHTML = `
                <div class="preview-question">
                    <h4>é¢˜ç›®é¢„è§ˆ</h4>
                    <p><strong>é¢˜ç›®ç±»å‹ï¼š</strong>${getQuestionTypeText(questionType)}</p>
                    <p><strong>é¢˜ç›®å†…å®¹ï¼š</strong>${questionContent}</p>
            `;
            
            if (questionType === 'single' || questionType === 'multiple') {
                const options = document.querySelectorAll('.option-input');
                if (options.length > 0) {
                    previewHTML += '<p><strong>é€‰é¡¹ï¼š</strong></p><ul>';
                    options.forEach((option, index) => {
                        if (option.value) {
                            previewHTML += `<li>${String.fromCharCode(65 + index)}. ${option.value}</li>`;
                        }
                    });
                    previewHTML += '</ul>';
                }
            }
            
            previewHTML += '</div>';
            preview.innerHTML = previewHTML;
        }
        
        function getQuestionTypeText(type) {
            const typeMap = {
                'single': 'å•é€‰é¢˜',
                'multiple': 'å¤šé€‰é¢˜',
                'judge': 'åˆ¤æ–­é¢˜',
                'essay': 'ç®€ç­”é¢˜'
            };
            return typeMap[type] || type;
        }
        
        // ä¿å­˜è‰ç¨¿
        function saveDraft() {
            if (validateForm()) {
                alert('æ­£åœ¨ä¿å­˜è‰ç¨¿...');
                setTimeout(() => {
                    alert('è‰ç¨¿ä¿å­˜æˆåŠŸï¼');
                    window.location.href = 'content.html';
                }, 1000);
            }
        }
        
        // è¡¨å•éªŒè¯
        function validateForm() {
            const questionType = document.getElementById('questionType').value;
            const questionContent = document.getElementById('questionContent').value;
            
            if (!questionType) {
                alert('è¯·é€‰æ‹©é¢˜ç›®ç±»å‹');
                return false;
            }
            
            if (!questionContent.trim()) {
                alert('è¯·è¾“å…¥é¢˜ç›®å†…å®¹');
                return false;
            }
            
            // éªŒè¯é€‰é¡¹
            if (questionType === 'single' || questionType === 'multiple') {
                const options = document.querySelectorAll('.option-input');
                let hasValidOption = false;
                options.forEach(option => {
                    if (option.value.trim()) {
                        hasValidOption = true;
                    }
                });
                
                if (!hasValidOption) {
                    alert('è¯·è‡³å°‘å¡«å†™ä¸€ä¸ªé€‰é¡¹');
                    return false;
                }
            }
            
            return true;
        }
        
        // è¡¨å•æäº¤
        document.getElementById('questionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!validateForm()) {
                return;
            }
            
            alert('æ­£åœ¨ä¿å­˜é¢˜ç›®...');
            setTimeout(() => {
                alert('é¢˜ç›®ä¿å­˜æˆåŠŸï¼');
                window.location.href = 'content.html';
            }, 1000);
        });
        
        // è¿”å›
        function goBack() {
            if (confirm('ç¡®å®šè¦ç¦»å¼€å—ï¼Ÿæœªä¿å­˜çš„å†…å®¹å°†ä¸¢å¤±ã€‚')) {
                window.location.href = 'content.html';
            }
        }
        
        // è§’è‰²åˆ‡æ¢åŠŸèƒ½
        function switchRole(role) {
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (role === 'student') {
                window.location.href = '../student/dashboard_simple.html';
            } else if (role === 'admin') {
                window.location.href = 'dashboard_simple.html';
            }
        }

        // é€€å‡ºåŠŸèƒ½
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç³»ç»Ÿå—ï¼Ÿ')) {
                window.location.href = '../index.html';
            }
        }

        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
        function updateUserInfo(username) {
            document.getElementById('currentUser').textContent = username;
        }
        
        // ç»‘å®šè¾“å…¥äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = ['questionType', 'questionContent'];
            inputs.forEach(id => {
                document.getElementById(id).addEventListener('input', updatePreview);
                document.getElementById(id).addEventListener('change', updatePreview);
            });
        });
    </script>
    
    <style>
        .option-item {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f8f9fa;
        }
        
        .option-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .option-label {
            min-width: 60px;
            font-weight: bold;
        }
        
        .option-input {
            flex: 1;
        }
        
        .question-preview {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .preview-question h4 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .preview-question p {
            margin-bottom: 10px;
        }
        
        .preview-question ul {
            margin-left: 20px;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
    </style>
</body>
</html>
