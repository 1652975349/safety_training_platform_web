<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢„è§ˆè¯¾ä»¶ - å®‰å…¨åŸ¹è®­å¹³å°</title>
    <link rel="stylesheet" href="../common/styles.css">
    <style>
        .preview-container {
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        
        .video-player {
            width: 100%;
            height: 500px;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }
        
        .document-viewer {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 16px;
        }
        
        .preview-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            padding: 20px;
            color: white;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            margin-bottom: 10px;
            cursor: pointer;
        }
        
        .progress-bar {
            height: 100%;
            background: #007bff;
            border-radius: 2px;
            width: 0%;
            transition: width 0.1s;
        }
        
        .control-buttons {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .time-display {
            color: white;
            font-size: 14px;
            min-width: 100px;
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .volume-slider {
            width: 80px;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            cursor: pointer;
        }
        
        .volume-progress {
            height: 100%;
            background: white;
            border-radius: 2px;
            width: 70%;
        }
    </style>
</head>
<body>
<!-- é¡¶éƒ¨é€šæ  - ç›´æ¥åµŒå…¥ -->
<header class="header">
    <div class="header-left">
        <div class="logo">å®‰å…¨åŸ¹è®­å¹³å°</div>
        <div class="role-switcher">
            <button class="role-btn" onclick="switchRole('student')">å­¦å‘˜ç«¯</button>
            <button class="role-btn active" onclick="switchRole('admin')">ç®¡ç†å‘˜ç«¯</button>
        </div>
    </div>
    <div class="header-right">
        <div class="user-info">
            <div class="avatar">ğŸ‘¤</div>
            <span id="currentUser">ç®¡ç†å‘˜</span>
        </div>
        <button class="btn btn-secondary" onclick="logout()">é€€å‡º</button>
    </div>
</header>

<!-- å·¦ä¾§èœå• - ç›´æ¥åµŒå…¥ -->
<nav class="sidebar" id="sidebar">
    <ul class="sidebar-menu" id="sidebarMenu">
        <li class="menu-item">
            <a href="dashboard_simple.html" class="menu-link">
                <span class="menu-icon">ğŸ </span>
                <span class="menu-text">é¦–é¡µ</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="personnel.html" class="menu-link">
                <span class="menu-icon">ğŸ‘¥</span>
                <span class="menu-text">äººå‘˜ç®¡ç†</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="training.html" class="menu-link">
                <span class="menu-icon">ğŸ“š</span>
                <span class="menu-text">åŸ¹è®­ç®¡ç†</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="content.html" class="menu-link active">
                <span class="menu-icon">ğŸ“„</span>
                <span class="menu-text">å†…å®¹ç®¡ç†</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="statistics.html" class="menu-link">
                <span class="menu-icon">ğŸ“Š</span>
                <span class="menu-text">ç»Ÿè®¡åˆ†æ</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="settings.html" class="menu-link">
                <span class="menu-icon">âš™ï¸</span>
                <span class="menu-text">ç³»ç»Ÿè®¾ç½®</span>
            </a>
        </li>
        <li class="menu-item">
            <a href="notifications.html" class="menu-link">
                <span class="menu-icon">ğŸ””</span>
                <span class="menu-text">é€šçŸ¥ç®¡ç†</span>
            </a>
        </li>
    </ul>
</nav>
    
    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="main-content">
        <div class="content-header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <button class="btn btn-secondary" onclick="goBack()">â† è¿”å›</button>
                <div>
                    <h1 class="page-title">é¢„è§ˆè¯¾ä»¶</h1>
                    <p class="page-subtitle" id="previewTitle">å®‰å…¨ç”Ÿäº§åŸºç¡€çŸ¥è¯†è§†é¢‘</p>
                </div>
            </div>
        </div>
        
        <!-- è¯¾ä»¶é¢„è§ˆåŒºåŸŸ -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">è¯¾ä»¶é¢„è§ˆ</h2>
                <div>
                    <span class="badge badge-info" id="previewType">è§†é¢‘</span>
                    <span class="badge badge-success" id="previewSize">125MB</span>
                </div>
            </div>
            <div class="card-body" style="padding: 0;">
                <!-- è§†é¢‘é¢„è§ˆ -->
                <div id="videoPreview" class="preview-container" style="display: block;">
                    <div class="video-player">
                        <div style="text-align: center;">
                            <div style="font-size: 48px; margin-bottom: 20px;">ğŸ¥</div>
                            <div>å®‰å…¨ç”Ÿäº§åŸºç¡€çŸ¥è¯†è§†é¢‘</div>
                            <div style="font-size: 14px; margin-top: 10px; opacity: 0.8;">ç‚¹å‡»æ’­æ”¾æŒ‰é’®å¼€å§‹é¢„è§ˆ</div>
                        </div>
                    </div>
                    <div class="preview-controls">
                        <div class="progress-bar-container" onclick="seekVideo(event)">
                            <div class="progress-bar" id="videoProgress"></div>
                        </div>
                        <div class="control-buttons">
                            <button class="btn btn-sm" style="background: transparent; border: none; color: white; font-size: 20px;" onclick="togglePlay()">
                                <span id="playIcon">â–¶ï¸</span>
                            </button>
                            <div class="time-display">
                                <span id="currentTime">00:00</span> / <span id="totalTime">45:00</span>
                            </div>
                            <div class="volume-control">
                                <span>ğŸ”Š</span>
                                <div class="volume-slider" onclick="adjustVolume(event)">
                                    <div class="volume-progress" id="volumeProgress"></div>
                                </div>
                            </div>
                            <button class="btn btn-sm" style="background: transparent; border: none; color: white; font-size: 16px;" onclick="toggleFullscreen()">
                                â›¶
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- æ–‡æ¡£é¢„è§ˆ -->
                <div id="documentPreview" class="preview-container" style="display: none;">
                    <div class="document-viewer">
                        <div style="text-align: center;">
                            <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“„</div>
                            <div>æ–‡æ¡£é¢„è§ˆ</div>
                            <div style="font-size: 14px; margin-top: 10px; opacity: 0.8;">PDF/Wordæ–‡æ¡£é¢„è§ˆåŠŸèƒ½</div>
                        </div>
                    </div>
                </div>
                
                <!-- PPTé¢„è§ˆ -->
                <div id="pptPreview" class="preview-container" style="display: none;">
                    <div class="document-viewer">
                        <div style="text-align: center;">
                            <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“Š</div>
                            <div>PPTé¢„è§ˆ</div>
                            <div style="font-size: 14px; margin-top: 10px; opacity: 0.8;">PowerPointæ¼”ç¤ºæ–‡ç¨¿é¢„è§ˆ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- è¯¾ä»¶ä¿¡æ¯ -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">è¯¾ä»¶ä¿¡æ¯</h2>
            </div>
            <div class="card-body">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div>
                        <label class="form-label">è¯¾ä»¶åç§°</label>
                        <p class="form-control-static" id="infoName">å®‰å…¨ç”Ÿäº§åŸºç¡€çŸ¥è¯†è§†é¢‘</p>
                    </div>
                    <div>
                        <label class="form-label">è¯¾ä»¶ç±»å‹</label>
                        <p class="form-control-static" id="infoType">è§†é¢‘</p>
                    </div>
                    <div>
                        <label class="form-label">æ–‡ä»¶å¤§å°</label>
                        <p class="form-control-static" id="infoSize">125MB</p>
                    </div>
                    <div>
                        <label class="form-label">å­¦æ—¶</label>
                        <p class="form-control-static" id="infoHours">0.75å°æ—¶</p>
                    </div>
                    <div>
                        <label class="form-label">ç§¯åˆ†å¥–åŠ±</label>
                        <p class="form-control-static" id="infoPoints">50ç§¯åˆ†</p>
                    </div>
                    <div>
                        <label class="form-label">éš¾åº¦ç­‰çº§</label>
                        <p class="form-control-static" id="infoDifficulty">ç®€å•</p>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <label class="form-label">è¯¾ä»¶æè¿°</label>
                    <p class="form-control-static" id="infoDescription">æ¶µç›–å®‰å…¨ç”Ÿäº§æ³•å¾‹æ³•è§„ã€å®‰å…¨ç®¡ç†åˆ¶åº¦ç­‰åŸºç¡€å†…å®¹ï¼Œé€‚ç”¨äºæ‰€æœ‰é•¿ç»´äººå‘˜ã€‚</p>
                </div>
                
                <div style="margin-top: 20px;">
                    <label class="form-label">æ ‡ç­¾</label>
                    <div id="infoTags">
                        <span class="badge badge-info">å®‰å…¨ç”Ÿäº§</span>
                        <span class="badge badge-info">æ³•å¾‹æ³•è§„</span>
                        <span class="badge badge-info">åŸºç¡€åŸ¹è®­</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <div class="card">
            <div class="card-body">
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button class="btn btn-primary" onclick="editCourseware()">âœï¸ ç¼–è¾‘è¯¾ä»¶</button>
                    <button class="btn btn-secondary" onclick="downloadCourseware()">ğŸ“¥ ä¸‹è½½è¯¾ä»¶</button>
                    <button class="btn btn-warning" onclick="shareCourseware()">ğŸ”— åˆ†äº«é“¾æ¥</button>
                    <button class="btn btn-info" onclick="viewUsage()">ğŸ“Š ä½¿ç”¨ç»Ÿè®¡</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isPlaying = false;
        let currentTime = 0;
        let totalTime = 2700; // 45åˆ†é’Ÿ = 2700ç§’
        
        // é¡µé¢åŠ è½½æ—¶ä»URLå‚æ•°è·å–è¯¾ä»¶ä¿¡æ¯
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const name = urlParams.get('name');
            const type = urlParams.get('type');
            
            if (name) {
                document.getElementById('previewTitle').textContent = name;
                document.getElementById('infoName').textContent = name;
            }
            
            if (type) {
                const typeMap = {
                    'video': 'è§†é¢‘',
                    'ppt': 'PPT',
                    'pdf': 'PDF',
                    'word': 'Word',
                    'excel': 'Excel'
                };
                
                const typeText = typeMap[type.toLowerCase()] || type;
                document.getElementById('previewType').textContent = typeText;
                document.getElementById('infoType').textContent = typeText;
                
                // æ ¹æ®ç±»å‹æ˜¾ç¤ºç›¸åº”çš„é¢„è§ˆåŒºåŸŸ
                showPreviewByType(type.toLowerCase());
            }
        });
        
        // æ ¹æ®ç±»å‹æ˜¾ç¤ºé¢„è§ˆåŒºåŸŸ
        function showPreviewByType(type) {
            // éšè—æ‰€æœ‰é¢„è§ˆåŒºåŸŸ
            document.getElementById('videoPreview').style.display = 'none';
            document.getElementById('documentPreview').style.display = 'none';
            document.getElementById('pptPreview').style.display = 'none';
            
            // æ˜¾ç¤ºå¯¹åº”çš„é¢„è§ˆåŒºåŸŸ
            if (type === 'video') {
                document.getElementById('videoPreview').style.display = 'block';
            } else if (type === 'ppt') {
                document.getElementById('pptPreview').style.display = 'block';
            } else {
                document.getElementById('documentPreview').style.display = 'block';
            }
        }
        
        // è¿”å›ä¸Šä¸€é¡µ
        function goBack() {
            window.history.back();
        }
        
        // æ’­æ”¾/æš‚åœ
        function togglePlay() {
            isPlaying = !isPlaying;
            const playIcon = document.getElementById('playIcon');
            playIcon.textContent = isPlaying ? 'â¸ï¸' : 'â–¶ï¸';
            
            if (isPlaying) {
                startPlayback();
            } else {
                stopPlayback();
            }
        }
        
        // å¼€å§‹æ’­æ”¾
        function startPlayback() {
            // æ¨¡æ‹Ÿæ’­æ”¾è¿›åº¦
            const interval = setInterval(() => {
                if (!isPlaying) {
                    clearInterval(interval);
                    return;
                }
                
                currentTime += 1;
                updateProgress();
                
                if (currentTime >= totalTime) {
                    currentTime = totalTime;
                    isPlaying = false;
                    document.getElementById('playIcon').textContent = 'â–¶ï¸';
                    clearInterval(interval);
                }
            }, 1000);
        }
        
        // åœæ­¢æ’­æ”¾
        function stopPlayback() {
            // åœæ­¢æ’­æ”¾é€»è¾‘
        }
        
        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            const progress = (currentTime / totalTime) * 100;
            document.getElementById('videoProgress').style.width = progress + '%';
            
            // æ›´æ–°æ—¶é—´æ˜¾ç¤º
            document.getElementById('currentTime').textContent = formatTime(currentTime);
        }
        
        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        // è·³è½¬è§†é¢‘
        function seekVideo(event) {
            const rect = event.currentTarget.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const width = rect.width;
            const percentage = x / width;
            
            currentTime = Math.floor(totalTime * percentage);
            updateProgress();
        }
        
        // è°ƒæ•´éŸ³é‡
        function adjustVolume(event) {
            const rect = event.currentTarget.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const width = rect.width;
            const percentage = x / width;
            
            document.getElementById('volumeProgress').style.width = (percentage * 100) + '%';
        }
        
        // å…¨å±
        function toggleFullscreen() {
            const previewContainer = document.querySelector('.preview-container');
            if (!document.fullscreenElement) {
                previewContainer.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }
        
        // ç¼–è¾‘è¯¾ä»¶
        function editCourseware() {
            const name = document.getElementById('infoName').textContent;
            const type = document.getElementById('infoType').textContent;
            
            const params = new URLSearchParams({
                name: name,
                type: type,
                size: '125MB',
                uploadTime: '2024-01-10'
            });
            window.location.href = `courseware-edit.html?${params.toString()}`;
        }
        
        // ä¸‹è½½è¯¾ä»¶
        function downloadCourseware() {
            const name = document.getElementById('infoName').textContent;
            if (confirm(`ç¡®å®šè¦ä¸‹è½½è¯¾ä»¶"${name}"å—ï¼Ÿ`)) {
                alert('æ­£åœ¨ä¸‹è½½è¯¾ä»¶...');
                setTimeout(() => {
                    alert('è¯¾ä»¶ä¸‹è½½å®Œæˆï¼');
                }, 1000);
            }
        }
        
        // åˆ†äº«è¯¾ä»¶
        function shareCourseware() {
            const name = document.getElementById('infoName').textContent;
            const shareUrl = `${window.location.origin}/student/learning-resources.html?resource=${encodeURIComponent(name)}`;
            
            if (navigator.share) {
                navigator.share({
                    title: name,
                    text: 'æŸ¥çœ‹è¿™ä¸ªå­¦ä¹ èµ„æº',
                    url: shareUrl
                });
            } else {
                // å¤åˆ¶åˆ°å‰ªè´´æ¿
                navigator.clipboard.writeText(shareUrl).then(() => {
                    alert('åˆ†äº«é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                });
            }
        }
        
        // æŸ¥çœ‹ä½¿ç”¨ç»Ÿè®¡
        function viewUsage() {
            const name = document.getElementById('infoName').textContent;
            alert(`æ­£åœ¨æŸ¥çœ‹è¯¾ä»¶"${name}"çš„ä½¿ç”¨ç»Ÿè®¡...`);
            // è¿™é‡Œå¯ä»¥è·³è½¬åˆ°ç»Ÿè®¡é¡µé¢
        }
        
        // è§’è‰²åˆ‡æ¢åŠŸèƒ½
        function switchRole(role) {
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (role === 'student') {
                window.location.href = '../student/dashboard_simple.html';
            } else if (role === 'admin') {
                window.location.href = 'dashboard_simple.html';
            }
        }

        // é€€å‡ºåŠŸèƒ½
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç³»ç»Ÿå—ï¼Ÿ')) {
                window.location.href = '../index.html';
            }
        }

        // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
        function updateUserInfo(username) {
            document.getElementById('currentUser').textContent = username;
        }
        
        // åˆå§‹åŒ–æ—¶é—´æ˜¾ç¤º
        document.getElementById('totalTime').textContent = formatTime(totalTime);
    </script>
</body>
</html>
