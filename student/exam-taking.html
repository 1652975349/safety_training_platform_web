<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€ƒè¯•è¿›è¡Œä¸­ - å®‰å…¨åŸ¹è®­å¹³å°</title>
    <link rel="stylesheet" href="../common/styles.css">
    <style>
        .exam-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .exam-header {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .exam-info h1 {
            margin: 0;
            color: #333;
            font-size: 24px;
        }
        
        .exam-info p {
            margin: 5px 0 0 0;
            color: #666;
        }
        
        .exam-timer {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 15px 20px;
            text-align: center;
            min-width: 120px;
        }
        
        .timer-text {
            font-size: 18px;
            font-weight: bold;
            color: #dc3545;
        }
        
        .timer-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .question-container {
            background: #fff;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .question-number {
            background: #007bff;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .question-type {
            background: #28a745;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .question-text {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 25px;
            color: #333;
        }
        
        .options-container {
            margin-bottom: 30px;
        }
        
        .option-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .option-item:hover {
            border-color: #007bff;
            background: #f8f9ff;
        }
        
        .option-item.selected {
            border-color: #007bff;
            background: #e3f2fd;
        }
        
        .option-letter {
            background: #6c757d;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
        }
        
        .option-item.selected .option-letter {
            background: #007bff;
        }
        
        .option-text {
            flex: 1;
            font-size: 16px;
        }
        
        .exam-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .question-nav {
            display: flex;
            gap: 10px;
        }
        
        .nav-btn {
            padding: 10px 20px;
            border: 1px solid #dee2e6;
            background: #fff;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            background: #f8f9fa;
            border-color: #007bff;
        }
        
        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .submit-section {
            text-align: right;
        }
        
        .submit-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .submit-btn:hover {
            background: #c82333;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .progress-fill {
            height: 100%;
            background: #007bff;
            transition: width 0.3s ease;
        }
        
        .camera-monitor {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 200px;
            height: 150px;
            background: #000;
            border-radius: 8px;
            border: 2px solid #dc3545;
            z-index: 1000;
        }
        
        .camera-monitor video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 6px;
        }
        
        .camera-status {
            position: absolute;
            top: -25px;
            left: 0;
            background: #dc3545;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .warning-banner {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .warning-icon {
            font-size: 24px;
        }
        
        .warning-text {
            flex: 1;
        }
        
        .warning-text strong {
            color: #856404;
        }
        
        .warning-text small {
            color: #856404;
            display: block;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <!-- æ‘„åƒå¤´ç›‘æ§ -->
    <div class="camera-monitor">
        <div class="camera-status">ğŸ”´ ç›‘æ§ä¸­</div>
        <video id="cameraVideo" autoplay muted></video>
    </div>

    <div class="exam-container">
        <!-- è€ƒè¯•å¤´éƒ¨ä¿¡æ¯ -->
        <div class="exam-header">
            <div class="exam-info">
                <h1 id="examTitle">å®‰å…¨ç”Ÿäº§åŸºç¡€çŸ¥è¯†è€ƒè¯•</h1>
                <p>æ­£å¼è€ƒè¯• - äººè„¸è¯†åˆ«é˜²ä½œå¼Šå·²å¯ç”¨</p>
            </div>
            <div class="exam-timer">
                <div class="timer-text" id="timer">60:00</div>
                <div class="timer-label">å‰©ä½™æ—¶é—´</div>
            </div>
        </div>
        
        <!-- è¿›åº¦æ¡ -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar" style="width: 20%"></div>
        </div>
        
        <!-- è­¦å‘Šæç¤º -->
        <div class="warning-banner">
            <div class="warning-icon">âš ï¸</div>
            <div class="warning-text">
                <strong>è€ƒè¯•è¿›è¡Œä¸­</strong>
                <small>è¯·ä¿æŒé¢éƒ¨åœ¨æ‘„åƒå¤´èŒƒå›´å†…ï¼Œä¸å¾—ç¦»å¼€åº§ä½æˆ–ä½¿ç”¨ä»»ä½•ä½œå¼Šå·¥å…·ã€‚ç³»ç»Ÿå°†å…¨ç¨‹ç›‘æ§è€ƒè¯•è¿‡ç¨‹ã€‚</small>
            </div>
        </div>
        
        <!-- é¢˜ç›®å®¹å™¨ -->
        <div class="question-container">
            <div class="question-header">
                <div class="question-number" id="questionNumber">ç¬¬ 1 é¢˜</div>
                <div class="question-type" id="questionType">å•é€‰é¢˜</div>
            </div>
            
            <div class="question-text" id="questionText">
                æ ¹æ®ã€Šå®‰å…¨ç”Ÿäº§æ³•ã€‹è§„å®šï¼Œç”Ÿäº§ç»è¥å•ä½çš„ä¸»è¦è´Ÿè´£äººå¯¹æœ¬å•ä½çš„å®‰å…¨ç”Ÿäº§å·¥ä½œè´Ÿæœ‰ä»€ä¹ˆè´£ä»»ï¼Ÿ
            </div>
            
            <div class="options-container" id="optionsContainer">
                <div class="option-item" onclick="selectOption(this, 'A')">
                    <div class="option-letter">A</div>
                    <div class="option-text">å…¨é¢è´£ä»»</div>
                </div>
                <div class="option-item" onclick="selectOption(this, 'B')">
                    <div class="option-letter">B</div>
                    <div class="option-text">ä¸»è¦è´£ä»»</div>
                </div>
                <div class="option-item" onclick="selectOption(this, 'C')">
                    <div class="option-letter">C</div>
                    <div class="option-text">é¢†å¯¼è´£ä»»</div>
                </div>
                <div class="option-item" onclick="selectOption(this, 'D')">
                    <div class="option-letter">D</div>
                    <div class="option-text">ç®¡ç†è´£ä»»</div>
                </div>
            </div>
        </div>
        
        <!-- è€ƒè¯•æ§åˆ¶ -->
        <div class="exam-controls">
            <div class="question-nav">
                <button class="nav-btn" id="prevBtn" onclick="previousQuestion()" disabled>ä¸Šä¸€é¢˜</button>
                <button class="nav-btn" id="nextBtn" onclick="nextQuestion()">ä¸‹ä¸€é¢˜</button>
            </div>
            
            <div class="submit-section">
                <button class="submit-btn" onclick="submitExam()">æäº¤è¯•å·</button>
            </div>
        </div>
    </div>

    <script>
        // è€ƒè¯•æ•°æ®
        let currentQuestion = 0;
        let timeLeft = 3600; // 60åˆ†é’Ÿ = 3600ç§’
        let timer;
        let answers = {};
        let examData = {
            id: 'exam_001',
            title: 'å®‰å…¨ç”Ÿäº§åŸºç¡€çŸ¥è¯†è€ƒè¯•',
            duration: 60, // åˆ†é’Ÿ
            questions: [
                {
                    id: 1,
                    type: 'single',
                    text: 'æ ¹æ®ã€Šå®‰å…¨ç”Ÿäº§æ³•ã€‹è§„å®šï¼Œç”Ÿäº§ç»è¥å•ä½çš„ä¸»è¦è´Ÿè´£äººå¯¹æœ¬å•ä½çš„å®‰å…¨ç”Ÿäº§å·¥ä½œè´Ÿæœ‰ä»€ä¹ˆè´£ä»»ï¼Ÿ',
                    options: [
                        { letter: 'A', text: 'å…¨é¢è´£ä»»' },
                        { letter: 'B', text: 'ä¸»è¦è´£ä»»' },
                        { letter: 'C', text: 'é¢†å¯¼è´£ä»»' },
                        { letter: 'D', text: 'ç®¡ç†è´£ä»»' }
                    ],
                    correct: 'A'
                },
                {
                    id: 2,
                    type: 'single',
                    text: 'å®‰å…¨ç”Ÿäº§"ä¸‰åŒæ—¶"åˆ¶åº¦æ˜¯æŒ‡ä»€ä¹ˆï¼Ÿ',
                    options: [
                        { letter: 'A', text: 'åŒæ—¶è®¾è®¡ã€åŒæ—¶æ–½å·¥ã€åŒæ—¶æŠ•äº§ä½¿ç”¨' },
                        { letter: 'B', text: 'åŒæ—¶è§„åˆ’ã€åŒæ—¶å»ºè®¾ã€åŒæ—¶éªŒæ”¶' },
                        { letter: 'C', text: 'åŒæ—¶è®¾è®¡ã€åŒæ—¶å»ºè®¾ã€åŒæ—¶éªŒæ”¶' },
                        { letter: 'D', text: 'åŒæ—¶è§„åˆ’ã€åŒæ—¶æ–½å·¥ã€åŒæ—¶æŠ•äº§ä½¿ç”¨' }
                    ],
                    correct: 'A'
                },
                {
                    id: 3,
                    type: 'single',
                    text: 'å‘ç”Ÿç”Ÿäº§å®‰å…¨äº‹æ•…åï¼Œäº‹æ•…ç°åœºæœ‰å…³äººå‘˜åº”å½“ç«‹å³å‘è°æŠ¥å‘Šï¼Ÿ',
                    options: [
                        { letter: 'A', text: 'æœ¬å•ä½è´Ÿè´£äºº' },
                        { letter: 'B', text: 'å½“åœ°æ”¿åºœ' },
                        { letter: 'C', text: 'å…¬å®‰æœºå…³' },
                        { letter: 'D', text: 'æ¶ˆé˜²éƒ¨é—¨' }
                    ],
                    correct: 'A'
                },
                {
                    id: 4,
                    type: 'single',
                    text: 'å®‰å…¨ç”Ÿäº§æ ‡å‡†åŒ–å»ºè®¾çš„åŸºæœ¬è¦æ±‚æ˜¯ä»€ä¹ˆï¼Ÿ',
                    options: [
                        { letter: 'A', text: 'å…¨å‘˜å‚ä¸ã€æŒç»­æ”¹è¿›' },
                        { letter: 'B', text: 'é¢†å¯¼é‡è§†ã€èµ„é‡‘ä¿éšœ' },
                        { letter: 'C', text: 'åˆ¶åº¦å®Œå–„ã€è®¾å¤‡å…ˆè¿›' },
                        { letter: 'D', text: 'äººå‘˜åŸ¹è®­ã€æŠ€æœ¯å‡çº§' }
                    ],
                    correct: 'A'
                },
                {
                    id: 5,
                    type: 'single',
                    text: 'å±é™©åŒ–å­¦å“å‚¨å­˜åº”å½“ç¬¦åˆä»€ä¹ˆè¦æ±‚ï¼Ÿ',
                    options: [
                        { letter: 'A', text: 'åˆ†ç±»å‚¨å­˜ã€æ ‡è¯†æ¸…æ¥š' },
                        { letter: 'B', text: 'é›†ä¸­å‚¨å­˜ã€ä¾¿äºç®¡ç†' },
                        { letter: 'C', text: 'åˆ†æ•£å‚¨å­˜ã€å‡å°‘é£é™©' },
                        { letter: 'D', text: 'éœ²å¤©å‚¨å­˜ã€é€šé£è‰¯å¥½' }
                    ],
                    correct: 'A'
                }
            ]
        };

        // åˆå§‹åŒ–è€ƒè¯•
        function initExam() {
            // è·å–è€ƒè¯•ID
            const urlParams = new URLSearchParams(window.location.search);
            const examId = urlParams.get('id') || 'exam_001';
            
            // è®¾ç½®è€ƒè¯•æ ‡é¢˜
            document.getElementById('examTitle').textContent = examData.title;
            
            // å¯åŠ¨æ‘„åƒå¤´
            startCamera();
            
            // å¼€å§‹è®¡æ—¶
            startTimer();
            
            // æ˜¾ç¤ºç¬¬ä¸€é¢˜
            showQuestion(0);
            
            // æ›´æ–°è¿›åº¦æ¡
            updateProgress();
        }

        // å¯åŠ¨æ‘„åƒå¤´
        function startCamera() {
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(stream => {
                        const video = document.getElementById('cameraVideo');
                        video.srcObject = stream;
                    })
                    .catch(err => {
                        console.error('æ‘„åƒå¤´å¯åŠ¨å¤±è´¥:', err);
                        alert('æ‘„åƒå¤´å¯åŠ¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ‘„åƒå¤´æƒé™');
                    });
            }
        }

        // å¼€å§‹è®¡æ—¶
        function startTimer() {
            timer = setInterval(() => {
                timeLeft--;
                updateTimer();
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    // è®¡ç®—æˆç»©
                    let correctCount = 0;
                    examData.questions.forEach(question => {
                        if (answers[question.id] === question.correct) {
                            correctCount++;
                        }
                    });
                    
                    const score = Math.round((correctCount / examData.questions.length) * 100);
                    const isPassed = score >= 80;
                    
                    // æ˜¾ç¤ºè€ƒè¯•å®Œæˆæé†’
                    const message = `è€ƒè¯•æ—¶é—´åˆ°ï¼\n\næ‚¨çš„æˆç»©ï¼š${score}åˆ†\n${isPassed ? 'æ­å–œæ‚¨é€šè¿‡è€ƒè¯•ï¼' : 'å¾ˆé—æ†¾ï¼Œæ‚¨æœªé€šè¿‡è€ƒè¯•ï¼ˆåŠæ ¼åˆ†æ•°ï¼š80åˆ†ï¼‰'}\n\nç‚¹å‡»ç¡®å®šè¿”å›è€ƒè¯•ä¸­å¿ƒ`;
                    
                    alert(message);
                    
                    // è¿”å›è€ƒè¯•ä¸­å¿ƒé¡µé¢
                    window.location.href = 'exams.html';
                }
            }, 1000);
        }

        // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
        function updateTimer() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timer').textContent = timeString;
            
            // æ—¶é—´ä¸è¶³10åˆ†é’Ÿæ—¶å˜çº¢è‰²
            if (timeLeft <= 600) {
                document.getElementById('timer').style.color = '#dc3545';
            }
        }

        // æ˜¾ç¤ºé¢˜ç›®
        function showQuestion(index) {
            const question = examData.questions[index];
            
            // æ›´æ–°é¢˜ç›®ä¿¡æ¯
            document.getElementById('questionNumber').textContent = `ç¬¬ ${index + 1} é¢˜`;
            document.getElementById('questionType').textContent = question.type === 'single' ? 'å•é€‰é¢˜' : 'å¤šé€‰é¢˜';
            document.getElementById('questionText').textContent = question.text;
            
            // æ›´æ–°é€‰é¡¹
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach(option => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option-item';
                optionElement.onclick = () => selectOption(optionElement, option.letter);
                
                optionElement.innerHTML = `
                    <div class="option-letter">${option.letter}</div>
                    <div class="option-text">${option.text}</div>
                `;
                
                // å¦‚æœå·²ç»é€‰æ‹©è¿‡ï¼Œæ ‡è®°ä¸ºé€‰ä¸­çŠ¶æ€
                if (answers[question.id] === option.letter) {
                    optionElement.classList.add('selected');
                }
                
                optionsContainer.appendChild(optionElement);
            });
            
            // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
            document.getElementById('prevBtn').disabled = index === 0;
            document.getElementById('nextBtn').disabled = index === examData.questions.length - 1;
            
            // æ›´æ–°è¿›åº¦æ¡
            updateProgress();
        }

        // é€‰æ‹©ç­”æ¡ˆ
        function selectOption(element, answer) {
            // ç§»é™¤å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
            const options = document.querySelectorAll('.option-item');
            options.forEach(opt => opt.classList.remove('selected'));
            
            // è®¾ç½®å½“å‰é€‰é¡¹ä¸ºé€‰ä¸­çŠ¶æ€
            element.classList.add('selected');
            
            // ä¿å­˜ç­”æ¡ˆ
            const questionId = examData.questions[currentQuestion].id;
            answers[questionId] = answer;
        }

        // ä¸Šä¸€é¢˜
        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                showQuestion(currentQuestion);
            }
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            if (currentQuestion < examData.questions.length - 1) {
                currentQuestion++;
                showQuestion(currentQuestion);
            }
        }

        // æ›´æ–°è¿›åº¦æ¡
        function updateProgress() {
            const progress = ((currentQuestion + 1) / examData.questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        // æäº¤è€ƒè¯•
        function submitExam() {
            if (confirm('ç¡®å®šè¦æäº¤è¯•å·å—ï¼Ÿæäº¤åå°†æ— æ³•ä¿®æ”¹ç­”æ¡ˆã€‚')) {
                clearInterval(timer);
                
                // è®¡ç®—æˆç»©
                let correctCount = 0;
                examData.questions.forEach(question => {
                    if (answers[question.id] === question.correct) {
                        correctCount++;
                    }
                });
                
                const score = Math.round((correctCount / examData.questions.length) * 100);
                const isPassed = score >= 80;
                
                // æ˜¾ç¤ºè€ƒè¯•å®Œæˆæé†’
                const message = `è€ƒè¯•å®Œæˆï¼\n\næ‚¨çš„æˆç»©ï¼š${score}åˆ†\n${isPassed ? 'æ­å–œæ‚¨é€šè¿‡è€ƒè¯•ï¼' : 'å¾ˆé—æ†¾ï¼Œæ‚¨æœªé€šè¿‡è€ƒè¯•ï¼ˆåŠæ ¼åˆ†æ•°ï¼š80åˆ†ï¼‰'}\n\nç‚¹å‡»ç¡®å®šè¿”å›è€ƒè¯•ä¸­å¿ƒ`;
                
                alert(message);
                
                // è¿”å›è€ƒè¯•ä¸­å¿ƒé¡µé¢
                window.location.href = 'exams.html';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initExam);
        
        // é˜²æ­¢é¡µé¢åˆ·æ–°æˆ–å…³é—­
        window.addEventListener('beforeunload', function(e) {
            e.preventDefault();
            e.returnValue = 'è€ƒè¯•è¿›è¡Œä¸­ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
        });
    </script>
</body>
</html>
